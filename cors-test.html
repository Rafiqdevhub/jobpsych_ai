<!DOCTYPE html>
<html>
  <head>
    <title>CORS Test for JobPsych AI</title>
  </head>
  <body>
    <h1>JobPsych AI CORS Test</h1>
    <button onclick="testCORS()">Test CORS</button>
    <button onclick="testAnalyzeEndpoint()">Test Analyze Endpoint</button>
    <div id="result"></div>

    <script>
      const BACKEND_URL = "https://hr-resume-analyzer-backend.vercel.app"; // Replace with your actual backend URL

      async function testCORS() {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "<p>Testing CORS...</p>";

        try {
          const response = await fetch(`${BACKEND_URL}/api/cors-test`, {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
            },
          });

          if (response.ok) {
            const data = await response.json();
            resultDiv.innerHTML = `
                        <h3>✅ CORS Test Successful!</h3>
                        <p><strong>Status:</strong> ${response.status}</p>
                        <p><strong>Response:</strong> ${JSON.stringify(
                          data,
                          null,
                          2
                        )}</p>
                    `;
          } else {
            resultDiv.innerHTML = `
                        <h3>❌ CORS Test Failed</h3>
                        <p><strong>Status:</strong> ${response.status}</p>
                        <p><strong>Error:</strong> ${await response.text()}</p>
                    `;
          }
        } catch (error) {
          resultDiv.innerHTML = `
                    <h3>❌ CORS Test Error</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>This usually indicates a CORS issue.</p>
                `;
        }
      }

      async function testAnalyzeEndpoint() {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "<p>Testing analyze endpoint...</p>";

        try {
          // Test without file (should get validation error, not CORS error)
          const response = await fetch(`${BACKEND_URL}/api/analyze-resume`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({}),
          });

          resultDiv.innerHTML = `
                    <h3>✅ Analyze Endpoint Accessible</h3>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Response:</strong> ${await response.text()}</p>
                    <p><em>Note: 422 error is expected (validation error), not CORS error.</em></p>
                `;
        } catch (error) {
          resultDiv.innerHTML = `
                    <h3>❌ Analyze Endpoint Error</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>This indicates a CORS issue if you see network errors.</p>
                `;
        }
      }
    </script>
  </body>
</html>
